digraph G {
fontname = "Bitstream Vera Sans"
fontsize = 8

node [
fontname = "Bitstream Vera Sans"
fontsize = 8
shape = "record"
]

edge [
fontname = "Bitstream Vera Sans"
fontsize = 8
]

//
// RESSOURCES
//
subgraph clusterRessources {
label = "Ressources"

// Interface IEntity
IEntity [
label = "{\
\<interface\> - IEntity||\
+ getId() : unsigned int\l\
+ setId(id : unsigned int)\l\
+ getPosX() : unsigned int\l\
+ getPosY() : unsigned int\l\
+ setPosX(x : unsigned int) : void\l\
+ setPosY(y : unsigned int) : void\l\
+ getType() : EntityType\l\
+ getSkinType() : SkinType\l\
+ getPV() : unsigned int\l\
+ setPV(pv : unsigned int) : void\l\
+ getBulletType() : BulletType\l\
+ setBulletType(type ; BulletType) : void\l\
+ getSpawnFrameNum() : unsigned int\l\
+ setSpawnFrameNum(frameNum : unsigned int) : void\l\
+ start(IN : actionList : list\<Action *\>, OUT : partyActionList : list\<Action *\> &)\l\
+ clone() : IEntity *\l\
}"
]

// Class player
Player [
label = "{\
Player|\
- id : unsigned int\l\
- login : string\l\
- passwd : string\l\
- posX : unsigned int\l\
- posY : unsigned int\l\
- typeId : unsigned int\l\
- skinId : unsigned int\l\
- pv : int\l\
- spawnFrameNum : unsigned int\l\
- ready : bool\l\
- color : Color\l|\
+ Player()\l\
+ getLogin() : string\l\
+ setLogin(login : string) : void\l\
+ getPasswd() : string\l\
+ setPasswd(passwd : string) : void\l\
+ isReady() : bool\l\
+ setReady(ready : bool) : void\l\
+ getColor() : Color\l\
+ setColor(color : Color) : void\l\
}"
]

// Class Entity Factory
EntityFactory [
label = "{\
EntityFactory|\
#ifdef UNIX\l\
	typedef libHandler void*\l\
	typedef libProcAddr void*\l\
#endif\l\
#ifdef WIN32\l\
	typedef libHandler HMODULE\l\
	typedef libProcAddr FARPROC\l\
#endif\l\
- entities : map<EntityType, IEntity>\l\
- libHandler : ISharedLybrary &\l\
- \<static\> currentId : unsigned int\l|\
+ getEntity(EntityType) : IEntity &\l\
+ typeExists(EntityType) : bool\l\
- loadEntity(EntityType) : bool\l\
}"
]

//Class ObjectFactory
ObjectFactory [
label = "{\
ObjectFactory|\
- objects : map<ObjectType, IObject>\l|\
+ getObject(ObjectType) : IObject &\l\
+ typeExists(ObjectType) : bool\l\
}"
]

// Interface IObject
IObject [
label = "{\
\<interface\> - IObject||\
+ setChanges(IEntity &, partyActionList : list\<Action *\> &) : void\l\
+ getType() : ObjectType\l\
+ clone() : IObject *\l\
}"
]

// Class BonusHealth
BonusHealth [
label = "{BonusHealth}"
]

// Class Laser
Laser [
label = "{Laser}"
]

// Class DoubleLaser
DoubleLaser [
label = "{DoubleLaser}"
]

// Class Object0
Object0 [
label = "{...}"
]

// Class Ressoruce
Ressource [
label = "{\
Ressource|\
- monsters : vector\<IEntity *\>\l\
- objects : vector\<IObjects *\>\l\
- maps : vector\<Map *\>\l\
- players : vector\<Player *\>\l|\
+ loadMaps(mapScript : fstream) : void\l\
}"
]

// Class Map
Map [
label = "{\
Map|\
- frames : deque\<Frame\>\l\
- mapScript : fstream &\l\
- loaded : bool\l|\
+ Map(mapScript : fstream &)\l\
+ loadMap() : void\l\
+ getNumberOfFrame() : unsigned int\l\
+ getFrame(num : unsigned int) : Frame &\l\
+ getNextFrame() : Frame *\l\
+ popFront() : Frame *\l\
}"
]

// Class Frame
Frame [
label = "{\
Frame|\
- width : unsigned int\l\
- height : unsigned int\l\
- ceil : WallType\l\
- ceilHeight : unsigned int\l\
- floor : WallType\l\
- floorHeight : unsigned int\l\
- monsters : map\<EntityType, pair\<x : int, y : int\>\>\l\
- objects : map\<ObjectType, pair\<x : int, y : int\>\>\l\
}"
]

//
// SHARED LIBRARY ABSTRACTION
//
subgraph clusterAbsSharedLibrary {
label = "SharedLibrary Abstraction"

// Interface ISharedLibrary
ISharedLibrary [
label = "{\
\<interface\> - ISharedLibrary||\
+ libHandler libLoad(string filename)\l\
+ libProcAddr libGetProc(libHandler lib, string filename)\l\
+ bool libFree(libHandler lib)\l\
}"
]

// Class SharedLibrary_unix
SharedLibrary_unix [
label = "SharedLibrary_unix"
]

// Class SharedLibrary_windows
SharedLibrary_windows [
label = "SharedLibrary_windows"
]

} // End : Shared Library Abstraction

//
// MONSTER LIBRARY
//
subgraph clusterMonstersLibrary {
label = "Monster Library"

// Abstract class AMonster
AMonster [
label = "{\
\<abstract\> - AMonster|\
- id : unsigned int\l\
- posX : unsigned int\l\
- posY : unsigned int\l\
- typeId : unsigned int\l\
- skinId : unsigned int\l\
- pv : int\l\
- spawnFrameNum : unsigned int\l\
}"
]

// Entry points
EntryDynamicLibrary [
label = "{\
\<not a class\> - entry points|\
getInstance() ; IEntity &\l\
}"
]

// Class Monster1
Monster1 [
label = "{Monster1}"
]

// Class Monster2
Monster2 [
label = "{Monster2}"
]

// Class Monster3
Monster3 [
label = "{...}"
]

} // End : Monster Library

edge [
arrowhead = "odiamond"
style = "solid"
]

IEntity -> EntityFactory
IEntity -> Ressource
Map -> Ressource
IObject -> Ressource
Frame -> Map
Player -> Ressource

edge [
arrowhead = "diamond"
style = "solid"
]

ISharedLibrary -> EntityFactory
IObject -> ObjectFactory

edge [
arrowhead = "onormal"
style = "solid"
]

SharedLibrary_unix -> ISharedLibrary
SharedLibrary_windows -> ISharedLibrary
Monster1 -> AMonster
Monster2 -> AMonster
Monster3 -> AMonster

edge [
arrowhead = "onormal"
style = "dashed"
]

Player -> IEntity
AMonster -> IEntity
BonusHealth -> IObject
Laser -> IObject
DoubleLaser -> IObject
Object0 -> IObject

} // End : Ressource


//
// SERVER CORE
//
subgraph clusterServerCore {
label = "Server Core"

// Class Party
Party [
label = "{\
Party|...\l|...\l\
}"
]

// Class Server
Server [
label = "{\
Server|...\l|...\l\
}"
]

Client [
label = "{\
Client|\
+ UDPConnexion : IUDP*\l|\
}"
]

edge [
arrowhead = "diamond"
style = "solid"
]

Ressource -> Party
EntityFactory -> Party
ObjectFactory -> Party

edge [
arrowhead = "odiamond"
style = "solid"
]

Party -> Server

} // End : Server Core

//
// NETWORK
//
subgraph clusterNetwork {
label = "Network"

// Interface ITCPSession
ITCPSession [
label = "{\
\<interface\> - ITCPSession|\
+ run() : void\l\
+ poll() : bool\l\
+ write(Data, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

// Class CTCPSession_Unix
CTCPSession_Unix [
label = "{\
CTCPSession_Unix|\
- _socket : int\l\
- _server : TCPServer&\l\
- _bufferSize : unsigned int\l\
- _broken : bool\l\
- _canRead : bool\l\
- _canWrite : bool\l\
- _incoming : list\<Data\>\l\
+ outgoing : list\<Data\>\l\
+ mutexOutgoing : AbsMutex\l|\
+ CTCPSession_Unix(socket : int, server : TCPServer&, bufferSize : unsigned int)\l\
+ virtual run() : void\l\
+ poll() : bool\l\
+ write(Data, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

// Class CTCPSession_Win32
CTCPSession_Win32 [
label = "{\
CTCPSession_Win32|\
- _socket : SOCKET\l\
- _server : TCPServer&\l\
- _bufferSize : unsigned int\l\
- _broken : bool\l\
- _canRead : bool\l\
- _canWrite : bool\l\
- _incoming : list\<Data\>\l\
+ outgoing : list\<Data\>\l\
+ mutexOutgoing : AbsMutex\l|\
+ CTCPSession_Win32(socket : SOCKET, server : TCPServer&, bufferSize : unsigned int)\l\
+ virtual run() : void\l\
+ poll() : bool\l\
+ write(Data, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CTCPSession_Unix -> ITCPSession
CTCPSession_Win32 -> ITCPSession

edge [
arrowhead = "onormal"
style = "solid"
]

Server -> ITCPServer

/*
// Interface ITCPClient
ITCPClient [
label = "{\
\<interface\> - ITCPClient|\
typedef void* Data\l\l\
+ connect() : bool\l\
+ write(Date, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

// Class CTCPClient_Unix
CTCPClient_Unix [
label = "{\
CTCPClient_Unix|\
- _socket : int\l|\
+ connect() : bool\l\
+ write(Date, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

// Class CTCPClient_Win32
CTCPClient_Win32 [
label = "{\
CTCPClient_Win32|\
- _socket : SOCKET\l|\
+ connect() : bool\l\
+ write(Date, unsigned int) : int\l\
+ read(Data, unsigned int) : int\l\
+ close() : bool\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CTCPClient_Unix -> ITCPClient
CTCPClient_Win32 -> ITCPClient
*/

// Interface IUDP
IUDP [
label = "{\
\<interface\> - IUDP|\
typedef void* Data\l\l\
+ send(Data, unsigned int) : int\l\
+ receive(unsigned int) : int\l\
+ close() : void\l\
}"
]

// Class CUDP_Unix
CUDP_Unix [
label = "{\
CUDP_Unix|\
- _socket : int\l|\
+ send(Data, unsigned int) : int\l\
+ receive(unsigned int) : int\l\
+ close() : void\l\
}"
]

// Class CUDP_Win32
CUDP_Win32 [
label = "{\
CUDP_Win32|\
- _socket : SOCKET\l|\
+ send(Data, unsigned int) : int\l\
+ receive(unsigned int) : int\l\
+ close() : void\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CUDP_Unix -> IUDP
CUDP_Win32 -> IUDP

// Interface ITCPServer
ITCPServer [
label = "{\
\<interface\> - ITCPServer|\
typedef void* Data\l\l\
+ init() : bool\l\
+ run() : void\l\
+ processData() : void\l\
+ close() : void\l\
+ accept() : bool\l\
}"
]

// Class CTCPServer_Unix
CTCPServer_Unix [
label = "{\
CTCPServer_Unix|\
- _port : short\l\
- _socket : int\l\
- _bufferSize : unsigned int\l\
- _running : bool\l\
- _sessions : map\<ITCPSession*, AbsThread*\>\l\
+ requests : list\<pair\<ITCPSession*, Data\>\>\l\
+ mutexRequests : AbsMutex\l|\
+ CTCPServer_Unix(port : short, bufferSize : unsigned int)\l\
+ init() : bool\l\
+ virtual run() : void\l\
+ virtual processData() : void\l\
+ close() : void\l\
+ virtual accept() : bool\l\
}"
]

// Class CTCPServer_Win32
CTCPServer_Win32 [
label = "{\
CTCPServer_Win32|\
- _port : short\l\
- _socket : SOCKET\l\
- _bufferSize : unsigned int\l\
- _running : bool\l\
- _sessions : map\<ITCPSession*, AbsThread*\>\l\
+ requests : list\<pair\<ITCPSession*, Data\>\>\l\
+ mutexRequests : AbsMutex\l|\
+ CTCPServer_Win32(port : short, bufferSize : unsigned int)\l\
+ init() : bool\l\
+ virtual run() : void\l\
+ virtual processData() : void\l\
+ close() : void\l\
+ virtual accept() : bool\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CTCPServer_Unix -> ITCPServer
CTCPServer_Win32 -> ITCPServer

} // End : Network

//
// THREAD
//
subgraph clusterThread {
label = "Thread"

// Interface thread
IAbsThread [
label = "{\
\<interface\> - IAbsThread|\
typedef void* (*startRoutine)(void*)\l|\
+ launch(startRoutine, void* args) : bool\l\
+ join() : bool\l\
+ exit() : void\l\
}"
]

// Concrete thread class for unix
CAbsThread_Unix [
label = "{\
CAbsThread_Unix|\
- _tid : pthread_t*\l|\
+ launch(startRoutine, void* args) : bool\l\
+ join() : bool\l\
+ exit() : void\l\
}"
]

// Concrete thread class for windows
CAbsThread_Win32 [
label = "{\
CAbsThread_Win32|\
- _tid : HANDLE\l|\
+ launch(startRoutine, void* args) : bool\l\
+ join() : bool\l\
+ exit() : void\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CAbsThread_Unix -> IAbsThread
CAbsThread_Win32 -> IAbsThread

// Interface IAbsMutex
IAbsMutex [
label = "{\
\<interface\> - IAbsMutex|\
+ init() : bool\l\
+ destroy() : void\l\
+ lock() : bool\l\
+ tryLock() : bool\l\
+ unlock() : bool\l\
}"
]

// Class CAbsMutex_Unix
CAbsMutex_Unix [
label = "{\
CAbsMutex_Unix|\
- _mid : pthread_mutex_t*\l|\
+ init() : bool\l\
+ destroy() : void\l\
+ lock() : bool\l\
+ tryLock() : bool\l\
+ unlock() : bool\l\
}"
]

// Class CAbsMutex_Win32
CAbsMutex_Win32 [
label = "{\
CAbsMutex_Win32|\
- _mid : HANDLE\l|\
+ init() : bool\l\
+ destroy() : void\l\
+ lock() : bool\l\
+ tryLock() : bool\l\
+ unlock() : bool\l\
}"
]

edge [
arrowhead = "onormal"
style = "dashed"
]

CAbsMutex_Unix -> IAbsMutex
CAbsMutex_Win32 -> IAbsMutex

} // End : thread

edge [
arrowhead = "diamond"
style = "solid"
]

IAbsMutex -> CTCPServer_Unix
IAbsMutex -> CTCPSession_Win32
IAbsMutex -> CTCPSession_Unix
IAbsThread -> CTCPServer_Unix

edge [
arrowhead = "odiamond"
style = "solid"
]

ITCPServer -> ITCPSession
Server -> Client

edge [
arrowhead = "onormal"
style = "solid"
]

Client -> ITCPSession

}
